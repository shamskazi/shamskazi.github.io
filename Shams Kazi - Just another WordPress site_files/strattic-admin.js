(()=>{"use strict";function t(i){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(i)}jQuery((function(i){var e=!!strattic_flags.admin;if(window.PublishManager={initializing_publish:!1,publish_percentage:0,scrape_job_id:null,distribution_id:null,completed_jobs:[],publish_env:"",publish_type:null,publish_types:["full","quick","selective"],publish_text:null,publish_user:null,notice_performing_updates:!1,notice_publishing:!1,selective_publish_input_group:"",strattic_colors:{quick:"#00688B",quick_hover:"#2f395a",full:"#fb4246",full_hover:"#931922",selective:"#E2F6F9",selective_hover:"#fff"},initialize:function(){if("undefined"!=typeof strattic_publish_environments&&void 0!==strattic_publish_environments.distributions&&Object.keys(strattic_publish_environments.distributions).length){window.addEventListener("storage",PublishManager.handleStorageEvent,!1);var t=localStorage.getItem("publishEnvironment"),e=localStorage.getItem("distributionID");null!==t&&"undefined"!==t&&!1!==this.getDistributionId(t)||(t=Object.values(strattic_publish_environments.distributions)[0]),null!==e&&"undefined"!==e&&void 0!==strattic_publish_environments.distributions[e]||(e=Object.keys(strattic_publish_environments.distributions)[0]),this.setInitialPublishEnv(t,e),this.selective_publish_input_group=i(".selective-publish-input-group").first(),this.manageSLClasstoSelectiveInputs(),this.startAuthCheckObserver(),this.checkStatus()}else i("#strattic-environment-list").length&&this.setInterfaceSiteBusy()},getDistributionId:function(t){for(var i in strattic_publish_environments.distributions)if(t===strattic_publish_environments.distributions[i])return i;return!1},setStateVariables:function(t,i){this.publish_percentage=t,this.publish_text=i},setDistributionID:function(t){this.distribution_id=t,localStorage.setItem("distributionID",t)},setInitialPublishEnv:function(t,e){i("#strattic-environment-list").val(t),this.setPublishEnv(t,e),this.setStratticEnvListValues(t,e)},setPublishEnv:function(t,i){this.publish_env=t,this.setDistributionID(i),localStorage.setItem("publishEnvironment",t)},setPublishType:function(t){this.publish_type=t},setPublishUser:function(t){this.publish_user=t},setScrapeJobId:function(t){this.scrape_job_id=t},setInterfaceSiteBusy:function(t){e&&"undefined"!=typeof strattic_immediate_notices&&this.setNotice(strattic_immediate_notices.performing_updates),i(".strattic-publish").prop("disabled",!0).addClass("disabled"),i(".strattic-publish a").prop("disabled",!0).addClass("disabled");var s="site_restoring"===t?strattic_strings.restoringToolTip:strattic_strings.busyToolTip,a='<span class="strattic-tooltip">'+s+"</span>";(i(".strattic-publish").each((function(){var t=i(this).find(".strattic-tooltip");0===t.length&&(i(this).append(a),t=i(this).find(".strattic-tooltip")),t.html(s)})),i(".strattic-tooltip").removeProp("style"),!this.notice_performing_updates&&this.isGutenbergActive()&&e&&"undefined"!=typeof strattic_immediate_notices)&&o({text:strattic_immediate_notices.performing_updates,type:"warning"});this.notice_performing_updates=!0},setInterfaceSiteNotBusy:function(t){e&&"undefined"!=typeof strattic_immediate_notices&&this.removeNotice(strattic_immediate_notices.performing_updates),i('.strattic-publish:not([data-first-publish="true"]) .strattic-tooltip').remove(),t||PublishManager.initializing_publish||(i(".strattic-publish").not('[data-first-publish="true"]').prop("enabled",!0).removeClass("disabled"),i(".strattic-publish a").prop("enabled",!0).removeClass("disabled"))},setNotice:function(t){var i=document.getElementById("strattic-immediate-notice");if(i){i.style.display="block";var e="<p>"+t+"</p>";i.innerHTML.includes(e)||(i.innerHTML=e+i.innerHTML)}},removeNotice:function(t){var i=document.getElementById("strattic-immediate-notice");if(i){var e="<p>"+t+"</p>";i.innerHTML.includes(e)&&(i.innerHTML=i.innerHTML.replace(e,"")),""===i.innerHTML&&(i.style.display="none")}},setInterfaceIsPublishing:function(){i(".strattic-publish").prop("disabled",!0).addClass("disabled"),i(".selective-publish-input").prop("readonly",!0),i(".selective-publish-input-group button").prop("disabled",!0),i(".add-selective-publish-input").prop("disabled",!0),e&&"undefined"!=typeof strattic_immediate_notices&&this.setNotice(strattic_immediate_notices.site_publishing);var t=i("#strattic-progress-"+PublishManager.distribution_id);(i(t).show(),i("#wp-admin-bar-strattic > .ab-item").prop("disabled",!0).addClass("disabled publishing"),!PublishManager.notice_publishing&&PublishManager.isGutenbergActive()&&e&&"undefined"!=typeof strattic_immediate_notices)&&o({text:strattic_immediate_notices.site_publishing,type:"warning"});PublishManager.notice_publishing=!0},updateInterfaceDuringPublish:function(t,e){this.setInterfaceIsPublishing(),this.setStateVariables(t,e);var s=i("#strattic-progress-"+this.distribution_id),a=PublishManager.publish_type+"-"+PublishManager.publish_env,n="Publishing to "+PublishManager.publish_env+"... "+this.publish_percentage+"%",r=window.PublishManager.strattic_colors,o={};s.find("progress").val(this.publish_percentage),s.find(".progress-bar-number").text(this.publish_percentage+"%"),s.find(".progress-bar-message").text(this.publish_text),i(this.publish_types).each((function(t,e){o[e]="linear-gradient(to right, "+r[e]+" "+window.PublishManager.publish_percentage+"%, "+r[e+"_hover"]+" "+window.PublishManager.publish_percentage+"%)",e+"-live"!==a&&e+"-preview"!==a||i("button.strattic-publish."+a).css({backgroundImage:o[e]})})),i("#wp-admin-bar-strattic .ab-message, button."+a).html(n).addClass("publishing-message"),i("#wp-admin-bar-strattic > .ab-item").css({backgroundImage:o.full})},setInterfaceNotPublishing:function(t){i(".strattic-progress-bar").hide(),i("#wp-admin-bar-strattic > .ab-item").prop("disabled",!1).removeClass("disabled").css({backgroundImage:""}),i("button.strattic-publish").not('[data-first-publish="true"]').prop("disabled",!1).removeClass("disabled").css({backgroundImage:""}),i(".strattic-publish a.ab-item").prop("disabled",!1).removeClass("publishing"),i(".selective-publish-input").prop("readonly",!1),i(".selective-publish-input-group button").prop("disabled",!1),i(".add-selective-publish-input").prop("disabled",!1),e&&"undefined"!=typeof strattic_immediate_notices&&this.removeNotice(strattic_immediate_notices.site_publishing),this.resetPublishButtonText(),t&&this.successActions()},initModal:function(){var t=i("<div>").attr("id","strattic-modal"),e=i("<div>").attr("id","strattic-modal-scrim"),s=i("<div>").attr("id","strattic-modal-inner").addClass("strattic-ui"),a=i("<div>").attr("id","strattic-modal-header"),n=i("<div>").attr("id","strattic-modal-content"),r=i("<div>").addClass("strattic-modal-close"),o=i("<h2>").attr("id","strattic-modal-title");a.append(o).append(r),s.append(a).append(n),t.append(e).append(s),i("body").append(t),i("#strattic-modal").on("click","#strattic-modal-scrim, .strattic-modal-close",(function(){PublishManager.hideModal()}))},hideModal:function(){i("body").removeClass("strattic-ui-popup")},showModal:function(t,e,s){i("#strattic-modal").length||PublishManager.initModal(),i("#strattic-modal").attr("class",s),i("#strattic-modal-title").empty().append(t),i("#strattic-modal-content").empty().append(e),i("body").addClass("strattic-ui-popup")},showModalMessage:function(t){if(parseInt(this.distribution_id)){var e=this.distribution_id;i.get(strattic_ajax.admin_url,{"strattic-ajax":"get_modal_message","distribution-id":e,"message-key":t,nonce:strattic_ajax.nonce}).done((function(e){if(e.hasOwnProperty("data")&&e.hasOwnProperty("success")&&e.success){var s=i.parseHTML(e.data.content),a=e.data.title,n=t+" sl-modal-"+t;PublishManager.showModal(a,s,n)}}))}},addJustPublished:function(){i.get(strattic_ajax.admin_url,{"strattic-ajax":"recent_publish","distribution-id":this.distribution_id,nonce:strattic_ajax.nonce}).done((function(t){if(t.hasOwnProperty("data")&&t.hasOwnProperty("success")&&t.success){var e=window.PublishManager.publish_env,s=t.data.publish_type.charAt(0).toUpperCase()+t.data.publish_type.slice(1)+" Publish",a=t.data.user_email;a.match(/@.*\.?strattic.com/)&&(a="Strattic Admin"),i(".publish-group-"+e+" .never-published").hide(),i(".publish-group-"+e+" .has-publish").show(),i("#recent-publication-type-"+e).text(s),i("#recent-publication-user-"+e).text(a),i("#recent-publication-date-"+e).text("Just now")}}))},throwSelectivePublishError:function(t){var e=i(".example-url").html();i(".selective-publish-card .card-content-left p").after('<p class="selective-publish-error sl-selectivePublishError">'+t+" Please make sure to use the format: "+e+" or relative urls like /example/ and ensure you are not using query parameters.</p>"),alert(t+" Please make sure to use the format:\n"+window.location.origin+"/\nor relative urls like /example/ \nand ensure you are not using query parameters.")},checkStatus:function(){i.get(strattic_ajax.admin_url,{"strattic-ajax":"status",distribution_id:this.distribution_id,nonce:strattic_ajax.nonce}).done((function(t){if(t.hasOwnProperty("data")){if(t.data.deploying)switch(void 0!==t.data.jobId&&PublishManager.setScrapeJobId(t.data.jobId),void 0!==t.data.publishType&&PublishManager.setPublishType(t.data.publishType),void 0!==t.data.userEmail&&(t.data.userEmail.match(/@.*\.?strattic.com/)&&(t.data.userEmail="Strattic Admin"),PublishManager.setPublishUser(t.data.userEmail)),void 0!==t.data.distributionId&&PublishManager.setPublishEnv(strattic_publish_environments.distributions[t.data.distributionId],t.data.distributionId),t.data.status){case"first-stage-failed":PublishManager.failActions();break;case"first-stage-syncing":PublishManager.updateInterfaceDuringPublish(5,"Publishing static files…");break;case"first-stage-beginning":PublishManager.updateInterfaceDuringPublish(10,"Publishing latest changes…");break;case"first-stage-requesting":PublishManager.updateInterfaceDuringPublish(15,"Publishing latest changes…");break;case"first-stage-publishing":var e=PublishManager.calculateUpdatePercentage(15,90,t.data);PublishManager.updateInterfaceDuringPublish(e,"Publishing latest changes…");break;case"first-stage-completed":PublishManager.updateInterfaceDuringPublish(90,"Latest changes are published.");break;case"syncing-images":PublishManager.updateInterfaceDuringPublish(95,"Syncing site images.");break;case"publishing-completed":PublishManager.successActions()}else PublishManager.initializing_publish||PublishManager.setInterfaceNotPublishing();void 0!==t.data.notice&&this.setNotice(t.data.notice),-1!=i.inArray(t.data.error,["site_restoring","site_updating","site_creating","site_not_running"])?PublishManager.setInterfaceSiteBusy(t.data.error):PublishManager.setInterfaceSiteNotBusy(t.data.deploying)}else PublishManager.setInterfaceSiteBusy()})).always((function(i){"object"===t(i)&&403!==i.status&&setTimeout(PublishManager.checkStatus,1e3)})).fail((function(){PublishManager.setInterfaceSiteBusy()}))},startPublish:function(t,e){var s=this;this.initializing_publish=!0,this.setInterfaceIsPublishing(),this.updateInterfaceDuringPublish(0,"Starting...");var a=i("#strattic-advanced input#strattic-concurrentWorkers").val(),n=i("#strattic-advanced input#strattic-workerBatchSize").val(),r=i("#strattic-advanced input#strattic-addUrlsBatchSize").val(),o={"strattic-ajax":"deploy",distribution_id:PublishManager.distribution_id,fullPublish:!0,maxConcurrentWorkers:a,workerBatchSize:n,addUrlsBatchSize:r,nonce:strattic_ajax.nonce,publishType:t};"selective"===t&&(o.paths=e),i.get(strattic_ajax.admin_url,o,(function(t){PublishManager.initializing_publish=!1})).done((function(t){0===t.success&&"selective"===window.PublishManager.publish_type&&s.throwSelectivePublishError("Error with URL structure.")})).fail((function(t){console.error(t)}))},calculateUpdatePercentage:function(t,i,e){var s=(i-t)*(e.job_progress.progress||0),a=Math.round(t+s);return a>PublishManager.publish_percentage?a:PublishManager.publish_percentage},successActions:function(){this.addJustPublished(),this.setPublishCompleted(),this.setInterfaceNotPublishing(),this.notice_publishing=!1,this.resetFirstPublishButtons(),this.resetPublishButtonText(),this.resetSelectivePublishInputs(),this.completed_jobs.push(this.scrape_job_id),this.showModalMessage("success")},failActions:function(){this.setInterfaceNotPublishing(),this.showModalMessage("fail")},resetFirstPublishButtons:function(){i("button.env-"+this.publish_env+'.strattic-publish[data-first-publish="true"]').attr("data-first-publish",!1)},resetPublishButtonText:function(){var t=[];t.live="button.strattic-publish.env-"+strattic_strings.live+':not([data-first-publish="true"])',t.preview="button.strattic-publish.env-"+strattic_strings.preview+':not([data-first-publish="true"])',i("#wp-admin-bar-strattic .ab-message").html("").removeClass("publishing-message"),Object.keys(t).forEach((function(e){i(t[e]).each((function(t,s){var a=i(s).data("publishType");i(s).html('<span class="strattic-publish-type">'+a+'</span> Publish to <span class="strattic-env-name">'+strattic_strings[e]+"</span>").removeClass("publishing-message")}))}))},manageSLClasstoSelectiveInputs:function(){for(var t in strattic_publish_environments.distributions){var e=strattic_publish_environments.distributions[t];i("#".concat(e,".publish-tab-container .selective-publish-input")).each((function(t,e){var s=i(e).attr("class").match(/sl-[a-z]*SelectivePublishInput-\d*/g);i(s).each((function(t,s){i(e).removeClass(s)})),i(e).addClass("sl-".concat(e.dataset.slClassType,"SelectivePublishInput-").concat(t))}))}},resetSelectivePublishInputs:function(){var t=i(window.PublishManager.selective_publish_input_group).clone();i(t).find("input").val(""),i(".selective-publish-input-group").remove(),i(".selective-publish-inputs").prepend(t)},setPublishCompleted:function(){this.setTemporaryLocalStorage("publish-completed",PublishManager.distribution_id,10)},setTemporaryLocalStorage:function(t,i,e){localStorage.setItem(t,i),setTimeout((function(){localStorage.removeItem(t)}),1e3*e)},handleStorageEvent:function(t){switch(t.key){case"publish-completed":parseInt(t.newValue)&&PublishManager.successActions();break;case"success-popup-closed":"true"==t.newValue&&PublishManager.hideModal()}},isGutenbergActive:function(){return"undefined"!=typeof wp&&void 0!==wp.blockEditor},setStratticEnvListValues:function(t,e){i(".publish-list li.strattic-publish").hide(),i(".publish-list li.strattic-publish-"+t).show(),i('#strattic-environment-list option[value="'+t+'"]').data("first-publish")&&(i(".publish-list .strattic-quick-publish").parent().hide(),i(".publish-list .strattic-selective-publish").parent().hide()),i(".publish-sidebar-content .publish-group").hide(),i(".publish-sidebar-content .publish-group-"+t).show()},cleanSelectivePathStrings:function(t){return t.trim().replace(/(^\w+:|^)\/\//,"").replace(window.location.hostname,"").replace(/\?(.*)$/,"")},startAuthCheckObserver:function(){var t=i("#wp-auth-check-form");t.length&&new MutationObserver((function(t){t.forEach((function(t){"childList"===t.type&&t.removedNodes.length>0&&window.PublishManager.refreshNonce()}))})).observe(t[0],{childList:!0})},refreshNonce:function(){i.get(strattic_ajax.admin_url,{"strattic-ajax":"refresh_nonce",nonce:""}).done((function(t){t.success?(strattic_ajax.nonce=t.data,window.PublishManager.checkStatus()):window.PublishManager.setInterfaceSiteBusy()}))}},window.PublishManager.initialize(),i("#strattic-environment-list").change((function(t){var e=i("#strattic-environment-list option:selected").data().distributionId,s=strattic_publish_environments.distributions[e];window.PublishManager.setPublishEnv(s,e),i('.publish-tabs-container a[href="#'+s+'"]').click(),window.PublishManager.setStratticEnvListValues(s,e)})),i("#wp-admin-bar-strattic > a.ab-item").click((function(t){t.preventDefault()})),i((function(){i("#tabs").tabs(),i("#tabs").tabs("option","active",{live:0,preview:1}[window.PublishManager.publish_env])})),i(".publish-tabs-container a").click((function(){var t=i(this).data("publishEnv"),e=i(this).data("publishId");!1!==window.PublishManager.getDistributionId(t)&&i("#strattic-environment-list").val(t),window.PublishManager.setStratticEnvListValues(t,e),window.PublishManager.setPublishEnv(t,e)})),i(".strattic-publish a.publish-item, button.strattic-publish").click((function(t){var e=!1;if(i(".selective-publish-error").remove(),i(this).data("distribution-id")?e=i(this).data("distribution-id"):parseInt(i(this).attr("rel"))&&(e=parseInt(i(this).attr("rel"))),e){window.PublishManager.setDistributionID(e);var s="full";i(this).data("publish-type")&&(s=i(this).data("publish-type"));var a=[];if("selective"===s){var n=".publish-tabs-container #"+window.PublishManager.publish_env+" .selective-publish-input",r=[],o=[];if(i(n).each((function(){""!==i(this).val()&&(r.push(window.PublishManager.cleanSelectivePathStrings(i(this).val())),o=r.filter((function(t,i){if(r.indexOf(t)===i)return r.indexOf(t)===i})))})),r.length!==o.length)return void window.PublishManager.throwSelectivePublishError("It looks like you have duplicate URLs.");a=o.map((function(t){return{path:t}}));var l=i(".strattic-publish-"+window.PublishManager.publish_env+" .strattic-selective-publish").data("pathToPublish");l&&a.push({path:l})}window.PublishManager.setPublishType(s),t.preventDefault(),i("#wp-admin-bar-strattic .ab-item.disabled").length||window.PublishManager.startPublish(s,a)}})),"undefined"!=typeof strattic_notices&&window.PublishManager.isGutenbergActive()&&void 0!==wp.data)for(var s=0,a=Object.keys(strattic_notices);s<a.length;s++){var n=a[s],r=new URL(strattic_current_url.url);r.searchParams.append("strattic-notice-remove",strattic_notices[n].slug),r.searchParams.append("_wpnonce",strattic_ajax.nonce),r=r.href,strattic_notices[n].remove=r,o(strattic_notices[n]),i.post(strattic_ajax.admin_url,{"strattic-notice-remove":n,_wpnonce:strattic_ajax.nonce})}function o(t){var i="";void 0!==t.remove&&(void 0===t.actions&&(t.actions=[]),i={isDismissible:!0,actions:t.actions.concat([{url:t.remove,label:strattic_hide_message.text}])}),wp.data.dispatch("core/notices").createNotice(t.type,t.text,i)}i("#reset_publish").click((function(){i.post(strattic_ajax.admin_url,{"strattic-ajax":"reset_publish",nonce:strattic_ajax.nonce},(function(t){alert(strattic_strings.publishReset)}))})),i(".add-selective-publish-input").on("click",(function(){var t=i(window.PublishManager.selective_publish_input_group).clone();i(t).find("input").val(""),i(this).before(t),i(t).find("input").focus(),window.PublishManager.manageSLClasstoSelectiveInputs()})),i(document).on("click",".remove-selective-input",(function(t){i(this).parent().remove(),window.PublishManager.manageSLClasstoSelectiveInputs()})),i(document).on({mouseenter:function(){""!==i(this).val()&&i(this).parent().prepend('<div class="selective-url-tooltip">'+i(this).val()+"</div>")},mouseleave:function(){i(this).siblings(".selective-url-tooltip").remove()},keyup:function(){""!==i(this).val()&&i(this).siblings(".selective-url-tooltip").text(i(this).val())}},".selective-publish-input"),window.StratticNoticesManager={initialize:function(){this.convertBBCodeLinks(),this.watchJsHideForever()},convertBBCodeLinks:function(){var t=this;if(window.PublishManager.isGutenbergActive()){var i=document.getElementsByClassName("components-notice__content");"undefined"!=typeof strattic_notices&&strattic_notices.length>0&&0===i.length&&setTimeout((function(){t.convertBBCodeLinks()}),1e3);for(var e=0;e<i.length;e++){var s=i[e].innerHTML;if(s.includes("[url=")){var a=s.split("[/url]"),n=void 0;for(n=0;n<a.length;n++){var r=a[n];if(r=(r=(r=r.replace("[url=",'<a class="js-new-window-links" href="')).replace("]",'" target="_blank" rel="noopener noreferrer">')).replace("[/url]","</a>"),a[n]=r,a[n].includes("Hide this message forever")){var o=a[n];a[n]=o.replace('class="','class="js-hide-message-forever ')}}s=a.join("</a>")}i[e].innerHTML=s,this.watchJsHideForever()}}},watchJsHideForever:function(){i(".js-hide-message-forever").click((function(t){t.preventDefault();var e=i(t.target).parents(".strattic-admin-notice, .components-notice");i.get(t.target.href).done((function(t){t.success&&i(e).html("<p>"+t.data.message+"</p>").fadeOut(4e3)})).fail((function(t){i(parent).html("<p>"+t.responseJSON.data.message+"</p>").removeClass("notice-info").addClass("notice-error")}))}))}},i(document).ready((function(){window.StratticNoticesManager.initialize()})),i("#form_submissions_select").change((function(t){t.preventDefault(),"false"!==t.target.value&&i(this).closest("form").submit()})),i("#strattic-download-submissions").click((function(t){t.preventDefault();var e=i("#form_submissions_select").val();if(!e)return!1;fetch(strattic_plugin_api_data.url+"forms/"+e+"/submissions/csv",{method:"GET",headers:{Authorization:strattic_plugin_api_data.token,Origin:location.origin},mode:"cors"}).then((function(t){return t.blob()})).then((function(t){var i=new Blob([t],{type:"text/csv"}),e=URL.createObjectURL(i),s=document.createElement("a");s.href=e,s.download="form_submissions.csv",document.body.appendChild(s),s.click()}))})),i(document).ready((function(){i("#siteurl").parents("tr").before('<tr><td colspan=2 style="padding-bottom: 0; padding-left: 0; width: 500px;"><div class="notice notice-error" style="max-width: 550px;"><p><strong>Looking to connect your custom domain? <a href="https://support.strattic.com/en/articles/3953461-connecting-your-domain-name-to-strattic" target="_blank" ref="noopener noreferrer">See documentation</a>.</strong><br/>Please do not change the WordPress URL and Site Address. They need to remain as-is with Strattic in the domain.</p></div></td></tr>')}))}))})();